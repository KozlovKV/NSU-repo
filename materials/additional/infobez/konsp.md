Интересные [материалы](https://vk.com/@spbctf-ctf-for-beginners) от Питерских CTFеров

# 23.09.09
Задачи из CTF обычно делятся на web, crypto, reverse-engineering, exploit (захват полного (или почти) доступа над удалённой машиной)

## Командная строка
- `cp -r` копирует директории
- `rm -r` - удаляет файлы рекурсивно (то есть удаляет папку)
- `chmod <mode> <file>`
- `|` - передаёт вывод команде перед в команду после

# 23.09.21
## Уровни OSI передачи данных
### **L2** - канальный уровень. 
На нём обмен данных может происходит в локальной сети. Обращение происходит по MAC-адресу. Здесь можно отдать файл сразу всем. Единицы данных - фрэймы

### **L3** - сетевой уровень. 
Преобразование из IP-адреса в MAC, а также маршрутизация. Единицы данных - пакеты.

Маска подсети - показывает, какая часть адреса отвечает за подсеть

**NAT - Network address translation** - позволяет получать ответы на разные устройства по одному внешнему IP-адресу

**ARP - Address resolution protocol** - позволяет по IP получить MAC-адрес

**ARP-spoofing атака** - заключается в том, что разные устройства могут посылать широковещательные пакеты, на которые устройства отвечают своим IP адресом вместе с MAC-адресом - однако никто не может гарантировать, что 2 устройства не ответят одинаковым IP адресом. Выяснить в таком случае, выяснить наверняка, кто хозяин адреса, практически невозможно.

**DHCP** - выдаёт адреса устройствам в сети

### DNS
Виды DNS записи при настройке домена:
- `A` - содержит адрес IPv4 для данного доменного имени
- `AAAA` - IPv6
- `CNAME` - перенаправление на доменное имя
- `MX` - почтовый сервер для данного домена
- `NS` - указывает на другой сервер для данного домена - это позволяет передать поддомены под управление личному доменному серверу
- `TXT` - произвольный текст

**DNS hijacking** - атака, суть которой в подмене DNS-сервера на тот, который будет действовать в пользу злоумышленника.

Есть 2 утилиты для проверки доменов
- На Линуксе это `dig @<кто отправит запрос> <кому отправить запрос> <тип>`
- На Windows - `nslookup -type=<тип> <кому> [кто]`

### **L4** Транспортный уровень
Здесь обитают протоколы **TCP** и **UDP**:
- **TCP** надёжен для передачи данных, требует постоянного соединения, повторно отправляет потерянные пакеты, сохраняет порядок сообщений, но работает медленно
- **UDP** лишён всех фишек надёжности, но зато быстрый

[Статья про утилиту NetCat](https://habr.com/ru/articles/657613/)

**Порт** - используется для того, чтобы один и тот же компьютер мог отправлять и получать данные по сети. Исходящие порты располагаются после `32768`

### **L7** Прикладной уровень
`HTTP[S]`, `FTP`, `SSH` и др.

#### HTTP
Основные методы:
- `GET` - используется для получения данных с сервера. Желательно, чтобы не менял состояние
- `POST` - изменяет состояние сервера и, также, может отправлять ответ
- `HEAD` - аналогичен `GET`, но в ответ присылаются только заголовки. Используется для кэширования
- `OPTIONS` - используется для определения возможностей сервера. Например, для того, чтобы узнать, какие методы доступны на странице. Список методов будет в заголовке `Allow`

Заголовки - пары вида `ключ:значение`. Пример заголовков:
- `Host` - адрес конкретного сервера по данному IP адресу
- `User-Agent` - с какого браузера обращается пользователь
- `Referer` - с какой страницы перешёл пользователь
- `Cookie` - набор пар `ключ=значение`, которые хранятся ограниченное время и используются для идентификации пользователя
- `Content-Type` - формат тела `POST`-запроса
  - `application/x-www-form-urlencoded` - пары `ключ=значение`, разделённые `&`
  - `application/json` - комментарии излишни
  - `multipart/form-data` - выглядит формат очень неприятно, но зато через него можно передавать файлы

`URL` - unified resource locator - стандарт записи ссылок:

`<протокол>://<логин>:<пароль>@<адрес.хоста>:<пароль>/<путь/на/сервере>?<ключ1>=<значение1>&<ключ2>=<значение2>#<хэш>`

HTTPS = HTTP + SSL. Мало чем отличается от обычного HTTP.

В общем виде запрос оформляется так
```
METHOD /path/on/server HTTP/1.1
Header-One: value
Header-Two: value

BODY
```
Пример GET-запроса:
```
GET /flag_file.txt HTTP/1.1
Host:nsuctf.ru
```
Пример POST-запроса
```
POST / HTTP/1.1
Host:nsuctf.ru
Content-Type: application/x-www-form-urlencoded
Content-Length: 13

get_flag=true
```

# 23.09.28
Как можно попасть на сайтах туда, куда не положено

## Листинг
Позволяет просматривать список файлов в директории без `index.(html/htm/php)`, если не заблокирован в глобальных настройках `.htaccess`

## `robots.txt`
Текстовый файл, содержащий пути сайта, которые может или не может индексировать поисковик. Использует хэдер `User-Agent`:
```
User-agent: Googlebot
Disallow: /private/
Allow: /for/indexing/
```
Запись `Disallow: /` запретит индексирование любой страницы

`Sitemap: /path/to/sitemap.xml` - указывает на путь к XML-файлу со списком рекомендованных к индексированию страниц

## Исходники

## Пути

## Бэкапы

## СКВ

## `.DS_store`

## Инъекции

## SQL-инъекции

# 23.10.05
## Инъекции команд
Если где-то есть возможность отправить на сайд команду или часть команды (например, сайт позволяет пинговать отправленный пользователем IP). Классический вариант - `; dangerous_code`:
- `; cat /etc/passwd`
- `; curl <our_url>`

### Некоторые особенности bash
`${cmd}` - возвращает вывод команды в место, где указан аргумент (позволяет исполнять команды в командах)

### Reverse-shell

- `nohup <cmd> &` - отправляет команду работать в фоне
- `bash -c 'nohup <cmd> & > /dev/null &` - запускает программу в фоне и освобождает потоки ввода-вывода

### Как защищаться от этих команд
- Заключать пользовательские аргументы в одинарные кавычки и удалять/экранировать апострофы внутри них самих
- Передавать аргументы в команды списками / массивами

Не поможет это командных инъекций аргументы пользователя в двойные кавычки, так как это не защищает от `${}`

### Инъекция аргументов
Чуть более специфичный вариант атаки через исполнение команд. Опасность представляют в таком раскладе немногие команды, например `git grep <string> <dir>` за счёт добавления флага `-O/path/to/bin` с путём до текстового редактора. В этом редакторе откроются все файлы из папки `<dir>`, которые удовлетворяют `<string>`